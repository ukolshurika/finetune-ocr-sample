# Finetune tesseract OCR
Тут собран пример дообучения модели Tesseract  для русского языка, так чтобы она распознавала дореволюционный язык с
ять, фета, i и т.д.

Важно! Команды написаны для командной строки Ubuntu. Для windows могут быть небольшие свои нюансы, но вполне возможно, что LLM их может исправить :) Ну или StackOverflow.

Основным материалом, которым я пользовалась чтобы получить удобо варимые результаты [тут](https://arcruz0.github.io/posts/finetuning-tess/).
Фактически это просто перевод и пример не с математическими символами, а дополнительными символами алфавита.


Алгоритм действий:
- берем страницы(вытаскиваем из pdf или если они уже картинками, оставляем).
- нарезаем страница на отдельные строки с помощью `hocr`
- запускаем распознавание на текущей модели
- правим вручную данные с помощью утилиты [tesseractgt](https://github.com/arcruz0/tesseractgt)
- делим данные на два набора: для обучения и для верификации качества распознавания
- запускаем обучение.

## Подготовка обучающего сета данных


Самое важно чтобы данные были хорошо подготовлены. Для своей задачи( мне нужно было распознавать краеведческие дореводюционные печатные тексты конца XIX века) я взяла из нескольких случайно выбранных книг страницы.

Для ряда задач можно найти уже [подготовленные данные](https://huggingface.co/datasets/nevmenandr/russian-old-orthography-ocr). Я же взяла книги из этого репозитория и дальше готовила по схеме, указанной ниже.

Книги были в pdf поэтому я использовала [`imagemagick`](https://imagemagick.org/script/download.php)

```
convert bogdanovich_p_i.dikij_chelovek.pdf[5-10] x_%03d.png
```

Тут указаны стриницы 5-10, но омжно хоть свю книжку так распознать.
Тут только нужно аккуратно

Файлы переносим отдельную папку (`myfiles/`), чтобы не было мешанины.

Запускаем скрипт разделения изображения на строки и заранее распознаем базовой моделью. В нем зашита модель распознавания(у меня русскоязычная, для другой базовой модели нужно поправить скрипт).

```
./split.sh
```

Запускаем R и правим руками данные

```
Rscript run_fix_dataset.R
```

Результаты и исходные примерные данные есть в папке `preparation`. Там же файл со скриптом для запуска R.

## Валидация
После того как модель прошла дообучение полезно посмотреть а насколько она точно умеет распознавать текст.
Проверка должна быть так же на размеченых данных, кроме того требуется разбивка на такие же изображения по формату.
Чтобы исключить ошибки связанные с разбиение на строки и т.п.

Код и файлы содержатся в папке  `validation`.

В папке `images/` лдеат файлы, которые будет распознавать тестируемая модель. В папке `txt/` распознанные вручную данные.

Запуск:

```
python check.py
```

Название обученной модели зашито в [коде](https://github.com/ukolshurika/finetune-ocr-sample/blob/master/validation/check.py#L8). Нужно поменять `orus` на своё название обученной модели, чтобы заработала проверка.